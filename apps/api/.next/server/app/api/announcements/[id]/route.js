"use strict";(()=>{var e={};e.id=950,e.ids=[950],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},5085:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>N,patchFetch:()=>_,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>y});var a={};t.r(a),t.d(a,{DELETE:()=>c});var n=t(9303),s=t(8716),o=t(670),u=t(7070),d=t(469),i=t(3887),l=t(9900),p=t(6103);async function c(e,{params:r}){let a=await (0,p.p)(e),n=await (0,p.yI)(e),{id:s}=await r;if(!n)return u.NextResponse.json({error:"Forbidden"},{status:403});let o=await d.db.query.announcements.findFirst({where:(0,l.xD)((0,l.eq)(i.announcements.id,s),(0,l.eq)(i.announcements.groupId,n))});if(!o)return u.NextResponse.json({error:"Not found"},{status:404});let{groupMembers:c}=await Promise.resolve().then(t.bind(t,3887)),m=await d.db.query.groupMembers.findFirst({where:(0,l.eq)(c.userId,a.id)});return m?.role!=="admin"&&o.authorId!==a.id?u.NextResponse.json({error:"Forbidden"},{status:403}):(await d.db.delete(i.announcements).where((0,l.eq)(i.announcements.id,s)),u.NextResponse.json({ok:!0}))}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/announcements/[id]/route",pathname:"/api/announcements/[id]",filename:"route",bundlePath:"app/api/announcements/[id]/route"},resolvedPagePath:"/Users/dan/Documents/Dev/smallgroup/apps/api/src/app/api/announcements/[id]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:g}=m,N="/api/announcements/[id]/route";function _(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:y})}},469:(e,r,t)=>{t.d(r,{db:()=>d});var a=t(3039),n=t(6129),s=t(3887);let o=process.env.DATABASE_URL,u=(0,n.Z)(o,{max:10}),d=(0,a.t)(u,{schema:s})},3887:(e,r,t)=>{t.r(r),t.d(r,{announcements:()=>g,announcementsRelations:()=>j,discussionTopics:()=>h,discussionTopicsRelations:()=>x,groupMembers:()=>y,groupMembersRelations:()=>R,groups:()=>f,groupsRelations:()=>q,prayerRequests:()=>b,prayerRequestsRelations:()=>D,roleEnum:()=>c,snackSignups:()=>_,snackSignupsRelations:()=>L,snackSlots:()=>N,snackSlotsRelations:()=>I,users:()=>m,usersRelations:()=>A,verseMemory:()=>w,verseMemoryProgress:()=>v,verseMemoryProgressRelations:()=>V,verseMemoryRelations:()=>M});var a=t(268),n=t(5735),s=t(1107),o=t(7726),u=t(4192),d=t(8064),i=t(9488),l=t(3238),p=t(4704);let c=(0,a.ys)("role",["admin","member"]),m=(0,n.af)("users",{id:(0,s.Vj)("id").primaryKey(),authId:(0,o.fL)("auth_id").notNull().unique(),email:(0,o.fL)("email").notNull(),displayName:(0,o.fL)("display_name"),birthdayMonth:(0,u._L)("birthday_month"),birthdayDay:(0,u._L)("birthday_day"),createdAt:(0,d.AB)("created_at").defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at").defaultNow().notNull()}),f=(0,n.af)("groups",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),name:(0,o.fL)("name").notNull(),createdAt:(0,d.AB)("created_at").defaultNow().notNull()}),y=(0,n.af)("group_members",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),groupId:(0,s.Vj)("group_id").notNull().references(()=>f.id,{onDelete:"cascade"}),userId:(0,s.Vj)("user_id").notNull().references(()=>m.id,{onDelete:"cascade"}),role:c("role").notNull().default("member"),joinedAt:(0,d.AB)("joined_at").defaultNow().notNull()}),g=(0,n.af)("announcements",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),groupId:(0,s.Vj)("group_id").notNull().references(()=>f.id,{onDelete:"cascade"}),authorId:(0,s.Vj)("author_id").notNull().references(()=>m.id,{onDelete:"cascade"}),title:(0,o.fL)("title").notNull(),body:(0,o.fL)("body").notNull(),link:(0,o.fL)("link"),createdAt:(0,d.AB)("created_at").defaultNow().notNull()}),N=(0,n.af)("snack_slots",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),groupId:(0,s.Vj)("group_id").notNull().references(()=>f.id,{onDelete:"cascade"}),slotDate:(0,i.hT)("slot_date").notNull(),createdAt:(0,d.AB)("created_at").defaultNow().notNull()}),_=(0,n.af)("snack_signups",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),slotId:(0,s.Vj)("slot_id").notNull().references(()=>N.id,{onDelete:"cascade"}),userId:(0,s.Vj)("user_id").notNull().references(()=>m.id,{onDelete:"cascade"}),createdAt:(0,d.AB)("created_at").defaultNow().notNull()}),h=(0,n.af)("discussion_topics",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),groupId:(0,s.Vj)("group_id").notNull().references(()=>f.id,{onDelete:"cascade"}),title:(0,o.fL)("title").notNull(),description:(0,o.fL)("description"),bibleReference:(0,o.fL)("bible_reference"),bibleText:(0,o.fL)("bible_text"),month:(0,u._L)("month").notNull(),year:(0,u._L)("year").notNull(),createdAt:(0,d.AB)("created_at").defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at").defaultNow().notNull()}),b=(0,n.af)("prayer_requests",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),groupId:(0,s.Vj)("group_id").notNull().references(()=>f.id,{onDelete:"cascade"}),authorId:(0,s.Vj)("author_id").notNull().references(()=>m.id,{onDelete:"cascade"}),content:(0,o.fL)("content").notNull(),isPrivate:(0,l.O7)("is_private").default(!1),prayed:(0,l.O7)("prayed").default(!1),createdAt:(0,d.AB)("created_at").defaultNow().notNull()}),w=(0,n.af)("verse_memory",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),groupId:(0,s.Vj)("group_id").notNull().references(()=>f.id,{onDelete:"cascade"}),verseReference:(0,o.fL)("verse_reference").notNull(),verseSnippet:(0,o.fL)("verse_snippet"),month:(0,u._L)("month").notNull(),year:(0,u._L)("year").notNull(),createdAt:(0,d.AB)("created_at").defaultNow().notNull()}),v=(0,n.af)("verse_memory_progress",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),verseId:(0,s.Vj)("verse_id").notNull().references(()=>w.id,{onDelete:"cascade"}),userId:(0,s.Vj)("user_id").notNull().references(()=>m.id,{onDelete:"cascade"}),memorized:(0,l.O7)("memorized").default(!1),updatedAt:(0,d.AB)("updated_at").defaultNow().notNull()}),A=(0,p.lE)(m,({many:e})=>({groupMembers:e(y),announcements:e(g),snackSignups:e(_),prayerRequests:e(b),verseMemoryProgress:e(v)})),q=(0,p.lE)(f,({many:e})=>({groupMembers:e(y),announcements:e(g),snackSlots:e(N),discussionTopics:e(h),prayerRequests:e(b),verseMemory:e(w)})),R=(0,p.lE)(y,({one:e})=>({group:e(f),user:e(m)})),j=(0,p.lE)(g,({one:e})=>({group:e(f),author:e(m)})),I=(0,p.lE)(N,({one:e,many:r})=>({group:e(f),signups:r(_)})),L=(0,p.lE)(_,({one:e})=>({slot:e(N),user:e(m)})),x=(0,p.lE)(h,({one:e})=>({group:e(f)})),D=(0,p.lE)(b,({one:e})=>({group:e(f),author:e(m)})),M=(0,p.lE)(w,({one:e,many:r})=>({group:e(f),progress:r(v)})),V=(0,p.lE)(v,({one:e})=>({verse:e(w),user:e(m)}))},6103:(e,r,t)=>{t.d(r,{yI:()=>c,mU:()=>p,kF:()=>m,p:()=>f});var a=t(5064);let n=process.env.NEXT_PUBLIC_SUPABASE_URL,s=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;var o=t(469),u=t(3887),d=t(9900),i=t(6113);let l="Small Group";async function p(e){let r=function(e){let r=e.headers.get("authorization");return r?.startsWith("Bearer ")&&r.slice(7).trim()||null}(e);if(!r)return null;let t=(0,a.eI)(n,s,{global:r?{headers:{Authorization:`Bearer ${r}`}}:void 0}),{data:{user:p},error:c}=await t.auth.getUser(r);if(c||!p)return null;let m=p.id,f=p.email??"",y=p.user_metadata?.full_name??p.user_metadata?.name??p.email??"Member",g=await o.db.query.users.findFirst({where:(0,d.eq)(u.users.authId,m)});if(g)return await o.db.update(u.users).set({email:f,displayName:y||g.displayName,updatedAt:new Date}).where((0,d.eq)(u.users.id,g.id)),await o.db.query.users.findFirst({where:(0,d.eq)(u.users.id,g.id)})??g;let N=await o.db.query.groups.findFirst({where:(0,d.eq)(u.groups.name,l)});if(!N){let[e]=await o.db.insert(u.groups).values({id:(0,i.randomUUID)(),name:l}).returning();N=e}let _=(0,i.randomUUID)();await o.db.insert(u.users).values({id:_,authId:m,email:f,displayName:y||"Member"});let h=0===(await o.db.select().from(u.groupMembers).where((0,d.eq)(u.groupMembers.groupId,N.id))).length;return await o.db.insert(u.groupMembers).values({groupId:N.id,userId:_,role:h?"admin":"member"}),await o.db.query.users.findFirst({where:(0,d.eq)(u.users.id,_)})??null}async function c(e){let r=await p(e);if(!r)return null;let t=await o.db.query.groupMembers.findFirst({where:(0,d.eq)(u.groupMembers.userId,r.id),columns:{groupId:!0}});return t?.groupId??null}async function m(e){let r=await f(e),t=await o.db.query.groupMembers.findFirst({where:(0,d.eq)(u.groupMembers.userId,r.id),columns:{role:!0}});if(t?.role!=="admin")throw new Response(JSON.stringify({error:"Forbidden"}),{status:403,headers:{"Content-Type":"application/json"}});return r}async function f(e){let r=await p(e);if(!r)throw new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}});return r}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,584],()=>t(5085));module.exports=a})();